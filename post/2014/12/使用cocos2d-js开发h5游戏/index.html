<!DOCTYPE html><html lang="zh-cn"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta name="renderer" content="webkit"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="referrer" content="always"><meta name="author" content="bukas"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="theme-color" content="#c05b4d"><meta name="msapplication-navbutton-color" content="#c05b4d"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#c05b4d"><meta name="format-detection" content="telphone=no, email=no"><meta name="msapplication-TileColor" content="#c05b4d"><meta name="screen-orientation" content="portrait"><meta name="x5-orientation" content="portrait"><meta name="apple-touch-fullscreen" content="yes"><meta name="full-screen" content="yes"><meta name="x5-fullscreen" content="true"><meta name="x5-page-mode" content="app"><meta name="browsermode" content="application"><meta name="msapplication-config" content="/browserconfig.xml"><link rel="manifest" href="/manifest.json"><meta name="msapplication-TileImage" content="/image/icon/144x144.png"><link rel="apple-touch-icon" sizes="60x60" href="/image/icon/60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/image/icon/72x72.png"><link rel="apple-touch-icon" sizes="120x120" href="/image/icon/120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/image/icon/144x144.png"><link rel="icon" type="image/png" sizes="192x192" href="/image/icon/192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/image/icon/32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/image/icon/96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/image/icon/16x16.png"><meta name="description" content="使用cocos2d-js开发h5游戏"><meta name="keywords" content="cocos2d-js, html5, 前端博客"><meta name="baidu-site-verification" content="SWwJlIQz43"><meta name="google-site-verification" content="9c8gt3muwQc_44xCxDE2Op-g1Wn9C2vzhYP-rXVLqlU"><link rel="amphtml" href="https://mercury.postlight.com/amp?url=https://www.noonme.com/post/2014/12/使用cocos2d-js开发h5游戏/"><link rel="alternate" href="/rss.xml" title="前端博客"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2.11.0"><link rel="canonical" href="https://www.noonme.com/post/2014/12/使用cocos2d-js开发h5游戏/"><link rel="stylesheet" href="/lib/fancybox/jquery.fancybox.css"><link rel="stylesheet" href="/lib/nprogress/nprogress.min.css"><link rel="stylesheet" href="/css/style.css?v=2.11.0"><script id="baidu_analytics">var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?b55278bdcb7115441071d19eb18b0d97";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-49034721-1"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-49034721-1")</script><script id="baidu_push">!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script src="//cdn1.lncld.net/static/js/3.1.1/av-min.js"></script><script id="leancloud">AV.init({appId:"xoEVsPhgw6N3YPfMBXnq6q1K-gzGzoHsz",appKey:"WMWiVHdG2AKdDrC6kgUCoBnU"})</script><script>window.config={leancloud:{app_id:"xoEVsPhgw6N3YPfMBXnq6q1K-gzGzoHsz",app_key:"WMWiVHdG2AKdDrC6kgUCoBnU"},toc:!0,fancybox:!0,pjax:!0,latex:!1}</script><title>使用cocos2d-js开发h5游戏 - 前端博客</title></head><body><div id="mobile-navbar" class="mobile-navbar"><div class="mobile-header-logo"><a href="/." class="logo">前端博客</a></div><div class="mobile-navbar-icon"><span></span> <span></span> <span></span></div></div><nav id="mobile-menu" class="mobile-menu slideout-menu"><ul class="mobile-menu-list"><a href="/"><li class="mobile-menu-item">首页</li></a><a href="/archives/"><li class="mobile-menu-item">归档</li></a><a href="/about"><li class="mobile-menu-item">关于</li></a></ul></nav><div class="container" id="mobile-panel"><header id="header" class="header"><div class="logo-wrapper"><a href="/." class="logo">前端博客</a></div><nav class="site-navbar"><ul id="menu" class="menu"><li class="menu-item"><a class="menu-item-link" href="/">首页</a></li><li class="menu-item"><a class="menu-item-link" href="/archives/">归档</a></li><li class="menu-item"><a class="menu-item-link" href="/about">关于</a></li></ul></nav></header><main id="main" class="main"><div class="content-wrapper"><div id="content" class="content"><article class="post"><header class="post-header"><h1 class="post-title">使用cocos2d-js开发h5游戏</h1><div class="post-meta"><span class="post-time">2014-12-16 </span><span class="post-category"><a href="/categories/technology/">technology</a> </span><span class="post-visits" data-url="/post/2014/12/使用cocos2d-js开发h5游戏/" data-title="使用cocos2d-js开发h5游戏">阅读次数 0</span></div></header><div class="post-toc" id="post-toc"><h2 class="post-toc-title">文章目录</h2><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#如何学习"><span class="toc-text">如何学习</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#如何开始"><span class="toc-text">如何开始</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#如何编码"><span class="toc-text">如何编码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#关于音频"><span class="toc-text">关于音频</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#一些工具"><span class="toc-text">一些工具</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#项目发布"><span class="toc-text">项目发布</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#一些可能对你有用的代码"><span class="toc-text">一些可能对你有用的代码</span></a></li></ol></div></div><div class="post-content"><p>最近一段时间，折腾了一下cocos2d-js，走过，坑过，跨过了一部分，还在加班填剩下的部分。好在今天终于抽出了点时间，因此便想要总结一下。</p><a id="more"></a><p>开始之前你可以先用微信扫一扫玩下我们做的游戏：</p><p><img src="http://7xp0ue.dl1.z0.glb.clouddn.com/2016-08-16_1471327305.png" alt="煤屎军团"></p><p>整个代码已经托管在github：<a href="https://github.com/huanz/msjt" target="_blank" rel="noopener">https://github.com/huanz/msjt</a></p><h2 id="如何学习">如何学习</h2><p>如何开始学习cocos2d-js？我我觉得比较好的方式是：</p><ol><li>看测试例：<a href="http://cocos2d-x.org/js-tests/" target="_blank" rel="noopener">测试例</a></li><li>看Api文档：a.<a href="http://www.cocos2d-x.org/reference/html5-js/V3.0/index.html" target="_blank" rel="noopener">在线API索引</a> b.<a href="http://www.cocos2d-x.org/filedown/Cocos2d-JS-v3.2-RC0-API.zip" target="_blank" rel="noopener">下载版API索引</a></li><li>看源码</li></ol><p>另外还有大神录制了进阶视频教程：<a href="http://cn.cocos2d-x.org/tutorial/lists?id=114" target="_blank" rel="noopener">Cocos2d-JS进阶视频教程</a>，里面关于自学的艺术还是讲的挺好的，在这里我就不累赘了。</p><h2 id="如何开始">如何开始</h2><p>如何开始很简单了，就两条：</p><ol><li>搭环境</li><li>编码</li></ol><p>如果你是做纯web的游戏，搭建环境很简单：</p><ol><li>下载引擎包</li><li>下载<a href="https://www.python.org/download/releases/2.7.6/" target="_blank" rel="noopener">Python2.7.6</a>，<a href="http://mirrors.cnnic.cn/apache//ant/binaries/apache-ant-1.9.4-bin.zip" target="_blank" rel="noopener">Ant</a>，如果没有安装java，请去下载**<a href="http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html" target="_blank" rel="noopener">jdk</a>至少1.7的版本**</li><li>配环境：无疑就是配置java环境、python环境、ant环境变量。基本上就是在系统环境变量path加入相关的bin目录地址。不会的自行google吧</li><li>创建项目：<code>cocos new -l js ProjectName</code></li><li>开始编码：sublime、webstorm等等用你喜欢的开发工具吧。</li></ol><p>官网也有相关文章：<a href="http://cn.cocos2d-x.org/article/index?type=cocos2d-x&amp;url=/doc/cocos-docs-master/manual/framework/cocos2d-js/2-working-environment-and-workflow/2-2-cross-native-browser-game-with-cocos-console/zh.md" target="_blank" rel="noopener">用Cocos Console工作流开发网页/原生平台游戏（JSB开发环境简介）</a></p><h2 id="如何编码">如何编码</h2><p>如何编码？如果团队协作，遵循团队的编码规范咯。这里我只是简单说一点点：</p><ol><li><p>关于<code>project.json</code>文件的配置信息</p><p>这个其实在main.js里面有注释说明</p><p></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">debugMode： <span class="number">0</span></span><br><span class="line"><span class="comment">//0 不显示任何错误信息</span></span><br><span class="line"><span class="comment">//1 显示cc.assert, cc.warn, cc.log</span></span><br><span class="line">	</span><br><span class="line">showFPS : <span class="literal">true</span></span><br><span class="line"><span class="comment">//为真会在屏幕左下方显示游戏帧率</span></span><br><span class="line"></span><br><span class="line">id: gameCanvas</span><br><span class="line"><span class="comment">//游戏画布的id</span></span><br><span class="line"></span><br><span class="line">renderMode： <span class="number">0</span></span><br><span class="line"><span class="comment">// 0 : 自动选择渲染引擎：webGl、canvas</span></span><br><span class="line"><span class="comment">// 1 : canvas</span></span><br><span class="line"><span class="comment">// 2 : WebGL（在webgl模式下drawNode会存在严重的锯齿）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// modules ： 游戏引用的模块</span></span><br><span class="line"><span class="comment">// 模块的名字可以在frameworks/cocos2d-html5/moduleConfig.json</span></span><br><span class="line"><span class="comment">// 里面找到，所以后期在上线的时候可以选择自己用到的模块引入来减少js文件的大小</span></span><br></pre></td></tr></table></figure><p></p></li></ol><ol start="2"><li><p>关于CCBoot.js</p><p><code>CCBoot.js</code>是入口js文件，所以你很有必要认真看一看其中的代码，比如其中提供一些可用的工具：</p><p></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建元素</span></span><br><span class="line">cc.newElement</span><br><span class="line"><span class="comment">//监听事件</span></span><br><span class="line">cc._addEventListener</span><br><span class="line"><span class="comment">//循环操作</span></span><br><span class="line">cc.each</span><br><span class="line"><span class="comment">//继承</span></span><br><span class="line">cc.extend</span><br><span class="line"></span><br><span class="line">cc.isFunction</span><br><span class="line">cc.isNumber</span><br><span class="line">cc.isString</span><br><span class="line">cc.isArray</span><br><span class="line">cc.isUndefined</span><br><span class="line">cc.isObject</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">//原生的渲染引擎：CanvasRenderingContext2D/WebGLRenderingContext</span></span><br><span class="line">cc._renderContext</span><br><span class="line"></span><br><span class="line"><span class="comment">//包裹游戏画布的外层div</span></span><br><span class="line">cc._gameDiv / cc.container</span><br></pre></td></tr></table></figure><p></p><p>比如一些你可能想要修改的东西：</p><p>包裹游戏的外层div的id名字：</p><p></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//大约CCBoot.js的1864行：</span></span><br><span class="line">localContainer.setAttribute(<span class="string">'id'</span>, <span class="string">'Cocos2dGameContainer'</span>);</span><br></pre></td></tr></table></figure><p></p><p>初始加载的时候的画布颜色：</p><p></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//大约CCBoot.js的641行： </span></span><br><span class="line">canvasNode.style.backgroundColor = <span class="string">"black"</span>;</span><br></pre></td></tr></table></figure><p></p><p>在<code>frameworks/cocos2d-html5/core/platform/</code>目录下也有很多东西，主要是平台相关的东西。</p><p>如简单操作dom的工具<code>miniFramework.js</code>里面的：</p><p></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cc.$</span><br></pre></td></tr></table></figure><p></p><p>屏幕适配相关的东西'CCEGLView.js'里面的：</p><p></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cc.view.adjustViewPort</span><br><span class="line">cc.view.setDesignResolutionSize</span><br><span class="line">cc.view.resizeWithBrowserSize</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p></p><p>文件加载相关的CCLoader.js：</p><p>cocos2d-js的文件加载是通过文件后缀的，如后缀名为<code>[&quot;png&quot;, &quot;jpg&quot;, &quot;bmp&quot;,&quot;jpeg&quot;,&quot;gif&quot;, &quot;ico&quot;]</code>的文件会通过<code>cc._imgLoader</code>来加载，理解了这里可以用于后期自定义文件加载插件。</p></li></ol><p>还有一些编码上面的东西放在下面再说。</p><h2 id="关于音频">关于音频</h2><p>音频，在移动端上一直是个巨坑的问题。能自动播放，不能自动播放、不能循环播放、根本就不播放等等简直就是处处都是坑啊。</p><p>开始游戏中的音频用的是cocos里面的封装的音频函数，会对音频文件进行预加载、预处理。但是这里有个严重的问题，那就是加载的时候很容易卡在音频那里，而且循环播放也有问题。于是决定用会原生的audio标签。</p><pre><code><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">audio</span> <span class="attr">id</span>=<span class="string">"gameAudio"</span> <span class="attr">src</span>=<span class="string">"res/gameMusic.mp3"</span> <span class="attr">loop</span>=<span class="string">"loop"</span>&gt;</span><span class="tag">&lt;/<span class="name">audio</span>&gt;</span></span><br></pre></td></tr></table></figure>
</code></pre><p>看起来应该是不错的样子，但是当我们在iphone4s微信内置浏览器里面测试的时候发现这个audio标签居然占据页面空间（不是说加了controls这个属性才会占空间么，坑啊！），于是自然而然想到的解决方案就是none掉：</p><pre><code><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">audio</span> <span class="attr">style</span>=<span class="string">"display:none"</span> <span class="attr">id</span>=<span class="string">"gameAudio"</span> <span class="attr">src</span>=<span class="string">"res/gameMusic.mp3"</span> <span class="attr">loop</span>=<span class="string">"loop"</span>&gt;</span><span class="tag">&lt;/<span class="name">audio</span>&gt;</span></span><br></pre></td></tr></table></figure>
</code></pre><p>感觉好像轻易解决了这个问题，于是开始编写一堆音频处理的代码。编写完毕之后，拿起iphone试一试，我去啊iphone上音频不能循环播放了啊，能不能再坑点！这个问题困扰了好久不知道什么原因，拿着代码去找师傅去吧！师傅只有一句话：ios上面音频如果不显示或者在屏幕之外有可能就会出问题哦！终于把display：none去掉一切又好了。孩子你还是太年轻了啊！对于占据空间的问题我们现在只能把音频标签作为body最后一个child节点，依然没有很好的解决方案。</p><p>对于音频的自动播放，目前只发现在iphone6 plus是可以的（iphone 6没有所以没试过），所以只能通过用户触摸事件来加载。如果在HTML标记中使用了autoplay属性，将会忽略这个属性，并且不会在加载页面时播放此文件，对于 preload 属性，同样会忽略。唯一能解决的就是用户进入页面是，让用户触发 touch 事件，并且只能在touch事件的回调里面加载才有效。</p><p></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> $audio = <span class="built_in">document</span>.getElementById(<span class="string">'gameAudio'</span>);</span><br><span class="line"><span class="comment">// 用户点击屏幕的任何一个地方就去加载音频</span></span><br><span class="line"><span class="built_in">document</span>.addEventListener(<span class="string">'touchstart'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">	$audio.load();</span><br><span class="line">&#125;,<span class="literal">false</span>);</span><br><span class="line">	</span><br><span class="line"><span class="comment">// 在某个cc.MenuItemImage/cc.MenuItemSprite/onTouchBegan的回调里面执行播放操作</span></span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">	$audio.play();</span><br><span class="line">&#125;<span class="keyword">catch</span>(e)&#123;&#125;</span><br></pre></td></tr></table></figure><p></p><p>音频的暂停：</p><p></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">    $audio.pause();</span><br><span class="line">&#125;<span class="keyword">catch</span>(e)&#123;&#125;</span><br></pre></td></tr></table></figure><p></p><p>音频的停止：</p><p></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">    $audio.currentTime = <span class="number">0</span>;</span><br><span class="line">    $audio.pause();</span><br><span class="line">&#125;<span class="keyword">catch</span>(e)&#123;&#125;</span><br></pre></td></tr></table></figure><p></p><p>如果是多个音频文件，可以使用音频audio sprite，所有的音频综合到一个单音频流中，然后播放此流的各个部分。</p><p></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> audioData = &#123;</span><br><span class="line">    bg: &#123;</span><br><span class="line">        start: <span class="number">0</span>,</span><br><span class="line">        length: <span class="number">1</span></span><br><span class="line">    &#125;,</span><br><span class="line">    run: &#123;</span><br><span class="line">        start: <span class="number">1.3</span>,</span><br><span class="line">        length: <span class="number">1.5</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p></p><p>要播放bg这段声音：</p><p></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">	$audio.currentTime = audioData.bg.start;</span><br><span class="line">	$audio.play();</span><br><span class="line">&#125;<span class="keyword">catch</span>(e)&#123;&#125;</span><br></pre></td></tr></table></figure><p></p><p>当播放结束时：</p><p></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$audio.addEventListener(<span class="string">'timeupdate'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (<span class="keyword">this</span>.currentTime &gt;= audioData.bg.start + audioData.bg.length) &#123;</span><br><span class="line">        <span class="keyword">this</span>.pause();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure><p></p><p>需要注意的是，更改 currentTime 并不是百分百正确的。假设 currentTime 设为 3.2，而实际得到的却是 3.4。每个 audio sprite 之间需要少量的空间，以避免寻找到另一个 sprite 的头部。</p><h2 id="一些工具">一些工具</h2><p><strong>精灵图制作：</strong><a href="https://www.codeandweb.com/texturepacker" target="_blank" rel="noopener">TexturePacker</a></p><p>相当好用的精灵图制作工具，虽然收费，但是可以申请免费的密钥，具体申请地址自己查吧。</p><p>用它制作精灵图的时候注意一个地方就可以了：</p><p><img src="http://blog.u.qiniudn.com/uploads/TexturePacke.png" alt></p><p>勾上这个Reduce border artifacts，它会让你的精灵图边缘没有锯齿，其它的配置地方我基本上都是默认的。</p><p><strong>位图字体制作：</strong><a href="http://www.angelcode.com/products/bmfont/" target="_blank" rel="noopener">Bitmap Font Generator</a></p><p>位图字体其实是一张图片，然后记录每个文字的位置和大小，因此字体的大小在生成的时候已经定义了，所以在用的时候最好不要改变字体的大小，如果改变了大小会对图片进行缩放，可能会出现锯齿。</p><p>用<a href="http://www.angelcode.com/products/bmfont/" target="_blank" rel="noopener">Bitmap Font Generator</a>这个软件制作的字体会生成一个png文件和一个fnt文件。选择左上方的<code>Options-&gt;Font settings</code>：</p><p><img src="http://blog.u.qiniudn.com/uploads/bmfont.png" alt></p><p>设置字体格式和字体大小。其它基本上都是默认设置就好了。</p><p>可以在主界面上面一个个点击选择需要制作的文字，也可以把要选择的字体放在一个txt文件里面（<strong>txt文件编码为Utf-8</strong>），然后选择菜单栏的<code>Edit-&gt;Select chars from file</code>来选择要制作的文字。</p><p>Bitmap Font Generator还支持从image文件生成字体纹理图,选择菜单栏的<code>Edit-&gt;Open Image Manager-&gt;Image-&gt;Import image</code>（注意路径里面不要有中文）</p><p><img src="http://blog.u.qiniudn.com/uploads/bmfonti.png" alt></p><p>Id那里填写对应文字的ASCII码，如我上传的图片里面的文字是2，其对应的ASCII码是50。如果不知道某个文字的ASCII码，可以去这里查：<a href="http://ascii.911cha.com/" target="_blank" rel="noopener">ASCII码对照表</a>。</p><p>选择好之后点击菜单栏<code>Options-&gt;Export options</code>：</p><p><img src="http://blog.u.qiniudn.com/uploads/bmfonte.png" alt></p><p>Padding那里设置每个文字的间距，如果你需要对文字有阴影什么的话，那你最好设置一下padding值，四个值分别是top、right、bottom、left的间距值。</p><p>Texture那里设置纹理图的大小，如果设置的太小，文字多的话他可能会生成多个纹理图，所以我建议设置宽高最好让文字能够放在一张图里面比较合适。</p><p>Bit depth设置色深，如果为了效果好点可以选择32，对效果要求没那么细腻，想要生成的文件小点可以选择8。</p><p>Presets那里设置生成的纹理图的样式，我一般选择是白色文字加上透明背景，即<code>White text with alpha</code></p><p>Textures生成纹理图的格式，肯定选择png了。</p><p><strong>字体精简：</strong><a href="http://www.high-logic.com/font-editor/fontcreator.html" target="_blank" rel="noopener">FontCreator</a></p><p>为什么需要加载字体？因为有时候页面上会有不同大小的特殊字体，用位图又比较麻烦，加载整个字体库又太大了，于是我找到了这个软件。</p><p>选择菜单栏<code>File-&gt;New Project</code>，填写你的字体名字和字体样式。然后选择菜单栏<code>File-&gt;Open</code>，打开你要精简的字体。（在新建项目的时候有一个Include outlines/Don'n include outlines的选项。如果选择Include outlines它会默认帮你添加一些字符）</p><p><img src="http://blog.u.qiniudn.com/uploads/fontc.png" alt></p><p>如果是可以直接看得到的字符，我可以直接在原有的字体文件中选中这个字符，然后复制粘贴到我的项目里面对应的位置上去，如果不是的话，我们可以通过下面的方法添加进去。</p><p>ctrl+f键查找某个字符，如我们要添加的字是“我”，然后右键选择<code>Glyph Properties</code></p><p><img src="http://blog.u.qiniudn.com/uploads/fontc1.png?" alt></p><p>复制<code>Codepoints</code>里面的参数，然后选中自己的项目，选择菜单栏<code>Insert-&gt;Charaacters</code>，把刚才复制的Codepoints粘贴到对应的位置。</p><p><img src="http://blog.u.qiniudn.com/uploads/fontc2.png" alt></p><p>这时你会发现在你项目字符的最后会添加一个灰色方块，回到原始字体那里，选中那个字直接复制粘贴到刚才添加的那个方块里面就可以了：</p><p><img src="http://blog.u.qiniudn.com/uploads/fontc3.jpg" alt></p><p>在上面的图里面你可以看到有很多灰色的方块，看看里面显示的字符，如果你用不到你可以直接点Delete键把它删掉。</p><p>除了用这个软件外，最近发现一个工具也可以用来精简压缩字体，感兴趣的可以试试：<a href="http://font-spider.org/" target="_blank" rel="noopener">字蛛——中文字体自动化压缩工具</a></p><p><strong>地图制作：</strong><a href="http://www.mapeditor.org/" target="_blank" rel="noopener">Tiled Map Editor</a></p><p>这个其实在我们的项目中没有用到，所以在这里提一下而已，有用到的可以自己去琢磨一下。</p><h2 id="项目发布">项目发布</h2><p>项目发布意味着什么？简单来说就意味着资源压缩、代码合并。首先来说下资源压缩吧。</p><p><strong>让你爱恨交加的closure compiler</strong></p><p>不是说cocos2d-js么？怎么会扯到closure compiler。如果你想要发布你的cocos2d游戏，我觉得就不得不说说closure compiler这玩意，这也是为何安装jdk的时候要求要jdk7以上的版本了。</p><p>在cocos项目发布的时候，有一个命令是<code>cocos compile -p web -m release --advanced</code>，后面加了一个<code>advanced</code>的参数，这种模式下面使用的是closure compiler的高级js压缩模式，压缩比例惊人，同时会优化js的执行，因此压缩之后的js性能也会得到一定提升。但是想要用这个高级压缩模式可是有坑的，很可能你会发现你的代码经过这种压缩模式压缩之后就报错了。</p><p>所以你最好去<a href="https://developers.google.com/closure/compiler/" target="_blank" rel="noopener">closure compiler官网</a>（google出品，所以需要翻墙）看一看，这里我只提简单的几点。</p><p>需要保留变量名的，要么用<code>@expose</code>关键字申明，要么使用<code>[]</code>来引用，如：</p><p></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** @expose */</span></span><br><span class="line"><span class="built_in">window</span>.MM;</span><br><span class="line"><span class="comment">/** @expose */</span></span><br><span class="line">M.add;</span><br><span class="line"><span class="comment">/** @expose */</span></span><br><span class="line">M.add.Pos;</span><br><span class="line"></span><br><span class="line"><span class="comment">// or</span></span><br><span class="line"><span class="built_in">window</span>[<span class="string">'MM'</span>];</span><br><span class="line">MM[<span class="string">'add'</span>];</span><br><span class="line">MM[<span class="string">'add'</span>][<span class="string">'Pos'</span>];</span><br></pre></td></tr></table></figure><p></p><p>比如在ajax请求数据的时候的请求参数和响应参数，你要写成这样：</p><p></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// request data</span></span><br><span class="line"><span class="comment">// 加引号</span></span><br><span class="line">&#123;<span class="string">'name'</span>: <span class="string">'dddd'</span>, <span class="string">'id'</span>: <span class="string">'123'</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// response data</span></span><br><span class="line"><span class="comment">// 通过数组的方式取值</span></span><br><span class="line">data[<span class="string">'list'</span>];</span><br><span class="line">data[<span class="string">'list'</span>][<span class="string">'userName'</span>]</span><br></pre></td></tr></table></figure><p></p><p>记住，任何你需要让它在压缩之后能保持原样输出的你都应该这样写。如果要了解更多你可以去它官网看看，或者看一看cocos2d-js的源码，里面有很多应对closure compiler高级压缩模式的注解。</p><p><strong>plist文件合并</strong></p><p>一次请求是比较耗费资源的，所以我们把plist文件合并在一个文件里面来加载，同时也对plist进行了压缩，下面是加载解析合并后的plist文件的插件源码：</p><p></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将plist合并成一个加载</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">cc._pjsonLoader = &#123;</span><br><span class="line">    KEY : &#123;</span><br><span class="line">        frames : <span class="number">0</span>,</span><br><span class="line">        rect : <span class="number">0</span>, <span class="attr">size</span> : <span class="number">1</span>, <span class="attr">offset</span> : <span class="number">2</span>, <span class="attr">rotated</span> : <span class="number">3</span>, <span class="attr">aliases</span> : <span class="number">4</span>,</span><br><span class="line">        meta : <span class="number">1</span>,</span><br><span class="line">        image : <span class="number">0</span></span><br><span class="line">    &#125;,</span><br><span class="line">    _parse : <span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> KEY = <span class="keyword">this</span>.KEY;</span><br><span class="line">        <span class="keyword">var</span> frames = &#123;&#125;, meta = data[KEY.meta] ? &#123;<span class="attr">image</span> : data[KEY.meta][KEY.image]&#125; : &#123;&#125;;</span><br><span class="line">        <span class="keyword">var</span> tempFrames = data[KEY.frames];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> frameName <span class="keyword">in</span> tempFrames) &#123;</span><br><span class="line">            <span class="keyword">var</span> f = tempFrames[frameName];</span><br><span class="line">            <span class="keyword">var</span> rect = f[KEY.rect];</span><br><span class="line">            <span class="keyword">var</span> size = f[KEY.size];</span><br><span class="line">            <span class="keyword">var</span> offset = f[KEY.offset];</span><br><span class="line">            frames[frameName] = &#123;</span><br><span class="line">                rect : &#123;<span class="attr">x</span> : rect[<span class="number">0</span>], <span class="attr">y</span> : rect[<span class="number">1</span>], <span class="attr">width</span> : rect[<span class="number">2</span>], <span class="attr">height</span> : rect[<span class="number">3</span>]&#125;,</span><br><span class="line">                size : &#123;<span class="attr">width</span> : size[<span class="number">0</span>], <span class="attr">height</span> : size[<span class="number">1</span>]&#125;,</span><br><span class="line">                offset : &#123;<span class="attr">x</span> : offset[<span class="number">0</span>], <span class="attr">y</span> : offset[<span class="number">1</span>]&#125;,</span><br><span class="line">                rotated : f[KEY.rotated],</span><br><span class="line">                aliases : f[KEY.aliases]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="attr">_inited</span> : <span class="literal">true</span>, <span class="attr">frames</span> : frames, <span class="attr">meta</span> : meta&#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    load : <span class="function"><span class="keyword">function</span>(<span class="params">realUrl, url, res, cb</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> self = <span class="keyword">this</span>, locLoader = cc.loader, cache = locLoader.cache;</span><br><span class="line">        locLoader.loadJson(realUrl, <span class="function"><span class="keyword">function</span>(<span class="params">err, pkg</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(err) <span class="keyword">return</span> cb(err);</span><br><span class="line">            <span class="keyword">var</span> dir = cc.path.dirname(url);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> pkg) &#123;</span><br><span class="line">                <span class="keyword">var</span> filePath = cc.path.join(dir, key);</span><br><span class="line">                cache[filePath] = self._parse(pkg[key]);</span><br><span class="line">            &#125;</span><br><span class="line">            cb(<span class="literal">null</span>, <span class="literal">true</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p></p><pre><code>//注册这个插件，前面说过cocos文件加载是通过文件后缀名来判断使用哪个加载器来加载的，所以这里会加载后缀名为.pjson的文件
</code></pre><p></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cc.loader.register([<span class="string">"pjson"</span>], cc._pjsonLoader);</span><br></pre></td></tr></table></figure><p></p><p>那么如何来生成这个<code>.pjson</code>文件呢？下面是我用<a href="http://nodejs.org/" target="_blank" rel="noopener">nodejs</a>写的一个脚本，可以读取目录下面所有的<code>.plist</code>文件，然后生成一个<code>.pjson</code>文件：</p><p></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//pjson.js</span></span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">var</span> plist = <span class="built_in">require</span>(<span class="string">'plist'</span>);</span><br><span class="line"><span class="keyword">var</span> pjson = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//var src = "res/*.plist";</span></span><br><span class="line"><span class="comment">//node pjson</span></span><br><span class="line">fs.readdir(<span class="string">'./res'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, files</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">throw</span> err;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = files.length - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">    	<span class="keyword">var</span> file = files[i],</span><br><span class="line">    		ext = file.split(<span class="string">'.'</span>)[<span class="number">1</span>];</span><br><span class="line">    	<span class="keyword">if</span>(ext === <span class="string">'plist'</span>)&#123;</span><br><span class="line">    		pjson[file] = [];</span><br><span class="line">    		pjson[file][<span class="number">0</span>] = &#123;&#125;;</span><br><span class="line">    		<span class="keyword">var</span> data = fs.readFileSync(<span class="string">'./res/'</span>+file, <span class="string">'UTF-8'</span>);</span><br><span class="line">			<span class="keyword">var</span> frames = plist.parse(data.toString()).frames;</span><br><span class="line">			<span class="keyword">var</span> fileName = <span class="built_in">Object</span>.keys(frames);</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">var</span> j=<span class="number">0</span>; j&lt; fileName.length; j++)&#123;</span><br><span class="line">				<span class="keyword">var</span> dat = pjson[file][<span class="number">0</span>][fileName[j]] = [];</span><br><span class="line">				<span class="keyword">var</span> frame = frames[fileName[j]];</span><br><span class="line">				dat[<span class="number">0</span>] = frame.frame.replace(<span class="regexp">/&#123;|&#125;/g</span>, <span class="string">''</span>).split(<span class="string">','</span>);</span><br><span class="line">				dat[<span class="number">1</span>] = frame.sourceSize.replace(<span class="regexp">/&#123;|&#125;/g</span>, <span class="string">''</span>).split(<span class="string">','</span>);</span><br><span class="line">				dat[<span class="number">2</span>] = frame.offset.replace(<span class="regexp">/&#123;|&#125;/g</span>, <span class="string">''</span>).split(<span class="string">','</span>);</span><br><span class="line">                <span class="keyword">if</span>(frame.rotated)  dat[<span class="number">3</span>] = <span class="number">1</span>;</span><br><span class="line">			&#125;</span><br><span class="line">    	&#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    fs.writeFile(<span class="string">'./res/plists.pjson'</span>, <span class="built_in">JSON</span>.stringify(pjson), <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">  		<span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">  		<span class="built_in">console</span>.log(<span class="string">'done!'</span>);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p></p><p>所以你需要在nodejs命令行里面运行：</p><p></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 第一次运行请先安装依赖包</span><br><span class="line">npm install plist</span><br><span class="line">	</span><br><span class="line">// 生成pjson文件</span><br><span class="line">node pjson.js</span><br></pre></td></tr></table></figure><p></p><p>那么如何使用这个文件呢？很简单，你只需要在<code>resource.js</code>的<code>g_resources</code>数组里面删除<code>plist</code>相关的，然后添加这个<code>plists.pjson</code>的路径就可以了，其它不用作任何改动。</p><p><strong>图片资源压缩</strong></p><p>关于图片和其他静态资源，我用了一个前端自动化任务工具<code>gulp</code>，不懂的可以看我上篇博文：<a href="http://w3cboy.com/post/2014/10/getting-started-with-gulp/" target="_blank" rel="noopener">Gulp上手</a>，下面是我针对项目配置的<code>gulp</code>任务<code>gulpfile.js</code>：</p><p></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> gulp = <span class="built_in">require</span>(<span class="string">'gulp'</span>),</span><br><span class="line">    imagemin = <span class="built_in">require</span>(<span class="string">'gulp-imagemin'</span>),</span><br><span class="line">    pngquant = <span class="built_in">require</span>(<span class="string">'imagemin-pngquant'</span>),</span><br><span class="line">    cache = <span class="built_in">require</span>(<span class="string">'gulp-cache'</span>),</span><br><span class="line">    autoprefixer = <span class="built_in">require</span>(<span class="string">'gulp-autoprefixer'</span>),</span><br><span class="line">    minifycss = <span class="built_in">require</span>(<span class="string">'gulp-minify-css'</span>),</span><br><span class="line">    rev = <span class="built_in">require</span>(<span class="string">'gulp-rev'</span>),</span><br><span class="line">    revReplace = <span class="built_in">require</span>(<span class="string">'gulp-rev-replace'</span>),</span><br><span class="line">    useref = <span class="built_in">require</span>(<span class="string">'gulp-useref'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> basePath = <span class="string">'publish/html5/'</span>;</span><br><span class="line"></span><br><span class="line">gulp.task(<span class="string">'image'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> gulp.src(basePath+<span class="string">'res/**/*.png'</span>)</span><br><span class="line">        .pipe(cache(imagemin(&#123;</span><br><span class="line">            optimizationLevel: <span class="number">7</span>,</span><br><span class="line">            use: [pngquant(&#123; <span class="attr">quality</span>: <span class="string">'60-80'</span>, <span class="attr">speed</span>: <span class="number">1</span> &#125;)]</span><br><span class="line">        &#125;)))</span><br><span class="line">        .pipe(gulp.dest(basePath+<span class="string">'res'</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">gulp.task(<span class="string">'style'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> gulp.src(<span class="string">'css/**/*.css'</span>)</span><br><span class="line">        .pipe(autoprefixer(<span class="string">'Android'</span>, <span class="string">'BlackBerry'</span>, <span class="string">'iOS'</span>, <span class="string">'OperaMobile'</span>, <span class="string">'ChromeAndroid'</span>, <span class="string">'FirefoxAndroid'</span>, <span class="string">'ExplorerMobile'</span>))</span><br><span class="line">        .pipe(minifycss())</span><br><span class="line">        .pipe(gulp.dest(basePath+<span class="string">'css'</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">gulp.task(<span class="string">'static'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> userefAssets = useref.assets();</span><br><span class="line">    <span class="keyword">return</span> gulp.src(basePath+<span class="string">'index.html'</span>)</span><br><span class="line">        .pipe(userefAssets)</span><br><span class="line">        .pipe(rev()) </span><br><span class="line">        .pipe(userefAssets.restore())</span><br><span class="line">        .pipe(useref())</span><br><span class="line">        .pipe(revReplace())</span><br><span class="line">        .pipe(gulp.dest(basePath));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">gulp.task(<span class="string">'default'</span>, [<span class="string">'image'</span>, <span class="string">'style'</span>, <span class="string">'static'</span>]);</span><br></pre></td></tr></table></figure><p></p><p>因为其中用到了对每次生成的js、css文件进行md5命名和合并操作，所以你需要在你的html文件里面作如下配置：</p><p></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- build:css css/main.css --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"css/a.css"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"css/b.css"</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- endbuild --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- build:js game.js --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"frameworks/cocos2d-html5/CCBoot.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"main.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- endbuild --&gt;</span></span><br></pre></td></tr></table></figure><p></p><p><strong>整个项目发布</strong></p><p>接着我写了一个整个项目的发布脚本<code>build.js</code>：</p><p></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> exec = <span class="built_in">require</span>(<span class="string">'child_process'</span>).exec;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> buildProcess = exec(<span class="string">'cocos compile -p web -m release --advanced'</span>, &#123;&#125;);</span><br><span class="line">buildProcess.on(<span class="string">'close'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">'start gulp task'</span>);</span><br><span class="line">	<span class="keyword">var</span> nextProcess = exec(<span class="string">'gulp default'</span>, &#123;&#125;);</span><br><span class="line">	nextProcess.on(<span class="string">'close'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="built_in">console</span>.log(<span class="string">'gulp task end'</span>);</span><br><span class="line">	&#125;);</span><br><span class="line">	nextProcess.stdout.setEncoding(<span class="string">'utf-8'</span>);</span><br><span class="line">	nextProcess.stdout.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">	    <span class="built_in">console</span>.log(data);</span><br><span class="line">	&#125;);</span><br><span class="line">	nextProcess.stderr.setEncoding(<span class="string">'utf-8'</span>);</span><br><span class="line">	nextProcess.stderr.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">	    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(data);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;);</span><br><span class="line">buildProcess.stdout.setEncoding(<span class="string">'utf-8'</span>);</span><br><span class="line">buildProcess.stdout.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;);</span><br><span class="line">buildProcess.stderr.setEncoding(<span class="string">'utf-8'</span>);</span><br><span class="line">buildProcess.stderr.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(data);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p></p><p>所以每次项目发布的时候，你只需要打开nodejs命令行，然后执行一下一个命令就完事：</p><p></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node build.js</span><br></pre></td></tr></table></figure><p></p><h2 id="一些可能对你有用的代码">一些可能对你有用的代码</h2><p><strong>ajax简单封装</strong></p><p></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">Utils.ArrayProto = <span class="built_in">Array</span>.prototype;</span><br><span class="line">Utils.slice = Utils.ArrayProto.slice;</span><br><span class="line"></span><br><span class="line">Utils.decode = <span class="built_in">decodeURIComponent</span>;</span><br><span class="line">Utils.encode = <span class="built_in">encodeURIComponent</span>;</span><br><span class="line"></span><br><span class="line">Utils.defaults = <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>)</span>&#123;</span><br><span class="line">    cc.each(Utils.slice.call(<span class="built_in">arguments</span>, <span class="number">1</span>), <span class="function"><span class="keyword">function</span>(<span class="params">o</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> k <span class="keyword">in</span> o)&#123;</span><br><span class="line">            <span class="keyword">if</span> (obj[k] == <span class="literal">null</span>) obj[k] = o[k];</span><br><span class="line">        &#125;    </span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> obj;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Utils.formData = <span class="function"><span class="keyword">function</span>(<span class="params">o</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> kvps = [], regEx = <span class="regexp">/%20/g</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> k <span class="keyword">in</span> o) kvps.push(Utils.encode(k).replace(regEx, <span class="string">"+"</span>) + <span class="string">"="</span> + Utils.encode(o[k].toString()).replace(regEx, <span class="string">"+"</span>));</span><br><span class="line">    <span class="keyword">return</span> kvps.join(<span class="string">'&amp;'</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Utils.ajax = <span class="function"><span class="keyword">function</span>(<span class="params">o</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> xhr = cc.loader.getXMLHttpRequest();</span><br><span class="line">    o = Utils.defaults(o, &#123;<span class="attr">type</span>: <span class="string">"GET"</span>, <span class="attr">data</span>: <span class="literal">null</span>, <span class="attr">dataType</span>: <span class="string">'json'</span>, <span class="attr">progress</span>: <span class="literal">null</span>, <span class="attr">contentType</span>: <span class="string">"application/x-www-form-urlencoded"</span>&#125;);</span><br><span class="line">    <span class="comment">//ajax进度的</span></span><br><span class="line">	<span class="comment">//if(o.progress) Utils.Progress.start(o.progress);</span></span><br><span class="line">    xhr.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (xhr.readyState == <span class="number">4</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span> (xhr.status &lt; <span class="number">300</span>)&#123;</span><br><span class="line">                <span class="keyword">var</span> res;</span><br><span class="line">                <span class="keyword">if</span>(o.dataType == <span class="string">'json'</span>)&#123;</span><br><span class="line">                    res = <span class="built_in">window</span>.JSON ? <span class="built_in">window</span>.JSON.parse(xhr.responseText): <span class="built_in">eval</span>(xhr.responseText);</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    res = xhr.responseText;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(!!res) o.success(res);</span><br><span class="line">				<span class="comment">////ajax进度的</span></span><br><span class="line">                <span class="comment">//if(o.progress) Utils.Progress.done();</span></span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">if</span>(o.error) o.error(xhr, xhr.status, xhr.statusText); </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">//是否需要带cookie的跨域</span></span><br><span class="line">	<span class="comment">//if("withCredentials" in xhr) xhr.withCredentials = true;</span></span><br><span class="line">    <span class="keyword">var</span> url = o.url, data = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">var</span> isPost = o.type == <span class="string">"POST"</span> || o.type == <span class="string">"PUT"</span>;</span><br><span class="line">    <span class="keyword">if</span>( o.data &amp;&amp; <span class="keyword">typeof</span> o.data == <span class="string">'object'</span> )&#123;</span><br><span class="line">        data = Utils.formData(o.data);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!isPost &amp;&amp; data) &#123;</span><br><span class="line">        url += <span class="string">"?"</span> + data;</span><br><span class="line">        data = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    xhr.open(o.type, url, <span class="literal">true</span>);</span><br><span class="line">    <span class="keyword">if</span> (isPost) &#123;</span><br><span class="line">        xhr.setRequestHeader(<span class="string">"Content-Type"</span>, o.contentType);</span><br><span class="line">    &#125;</span><br><span class="line">    xhr.send(data);</span><br><span class="line">    <span class="keyword">return</span> xhr;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Utils.get = <span class="function"><span class="keyword">function</span>(<span class="params">url, data, success</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(cc.isFunction(data))&#123;</span><br><span class="line">        success = data;</span><br><span class="line">        data = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Utils.ajax(&#123;<span class="attr">url</span>: url, <span class="attr">type</span>: <span class="string">"GET"</span>, <span class="attr">data</span>: data, <span class="attr">success</span>: success&#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Utils.post = <span class="function"><span class="keyword">function</span>(<span class="params">url, data, success</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(cc.isFunction(data))&#123;</span><br><span class="line">        success = data;</span><br><span class="line">        data = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Utils.ajax(&#123;<span class="attr">url</span>: url, <span class="attr">type</span>: <span class="string">"POST"</span>, <span class="attr">data</span>: data, <span class="attr">success</span>: success&#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p></p><p>用法和jquery的ajax用法类似</p><p><strong>LoaderScene重定义</strong></p><p>下面是我的loaderScene的一部分代码：</p><p></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> LoaderScene = cc.Scene.extend(&#123;</span><br><span class="line">    _interval : <span class="literal">null</span>,</span><br><span class="line">    _label : <span class="literal">null</span>,</span><br><span class="line">    _className:<span class="string">"LoaderScene"</span>,</span><br><span class="line">    numberSprites: [],</span><br><span class="line"></span><br><span class="line">    init : <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> self = <span class="keyword">this</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// bg</span></span><br><span class="line">        <span class="keyword">var</span> bgLayer = self._bgLayer = <span class="keyword">new</span> cc.LayerColor(cc.color(<span class="number">216</span>, <span class="number">216</span>, <span class="number">216</span>));</span><br><span class="line">        bgLayer.setPosition(cc.visibleRect.bottomLeft);</span><br><span class="line">        self.addChild(bgLayer, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//you codes</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    onEnter: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        cc.Node.prototype.onEnter.call(<span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">var</span> loader = (<span class="keyword">this</span>.loadType == <span class="string">'resource'</span>) ? <span class="keyword">this</span>._startLoading : <span class="keyword">this</span>._startAjax;</span><br><span class="line">        <span class="keyword">this</span>.schedule(loader, <span class="number">0.3</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    onExit: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        cc.Node.prototype.onExit.call(<span class="keyword">this</span>);</span><br><span class="line">        <span class="comment">//you codes</span></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    initWithResources: <span class="function"><span class="keyword">function</span> (<span class="params">resources, cb</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(cc.isString(resources))</span><br><span class="line">            resources = [resources];</span><br><span class="line">        <span class="keyword">this</span>.resources = resources || [];</span><br><span class="line">        <span class="keyword">this</span>.cb = cb;</span><br><span class="line">        <span class="keyword">this</span>.loadType = <span class="string">'resource'</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    _startLoading: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> self = <span class="keyword">this</span>;</span><br><span class="line">        self.unschedule(self._startLoading);</span><br><span class="line">        <span class="keyword">var</span> res = self.resources;</span><br><span class="line">        cc.loader.load(res, self._loadProgress.bind(self), <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (self.cb) self.cb();</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    initAjax: <span class="function"><span class="keyword">function</span>(<span class="params">ajaxSetting</span>)</span>&#123;</span><br><span class="line">    	<span class="keyword">this</span>.ajaxSetting = ajaxSetting;</span><br><span class="line">    	<span class="keyword">this</span>.loadType = <span class="string">'ajax'</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    _startAjax: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    	<span class="keyword">var</span> self = <span class="keyword">this</span>,</span><br><span class="line">    		preNum = <span class="number">0</span>;</span><br><span class="line">        self.unschedule(self._startAjax);</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">this</span>.ajaxSetting.progress)&#123;</span><br><span class="line">        	<span class="keyword">this</span>.ajaxSetting.progress = <span class="function"><span class="keyword">function</span>(<span class="params">n</span>)</span>&#123;</span><br><span class="line">        		n = n.toFixed(<span class="number">2</span>);</span><br><span class="line">        		<span class="keyword">if</span>(preNum === n) <span class="keyword">return</span>;</span><br><span class="line">        		preNum = n;</span><br><span class="line">        		self._loadProgress(<span class="literal">null</span>, <span class="number">1</span>, n);</span><br><span class="line">        	&#125;;</span><br><span class="line">        &#125;</span><br><span class="line">        Utils.ajax(<span class="keyword">this</span>.ajaxSetting);</span><br><span class="line">    &#125;,</span><br><span class="line">    _loadProgress: <span class="function"><span class="keyword">function</span>(<span class="params">result, count, loadedCount</span>)</span>&#123;</span><br><span class="line">    	<span class="keyword">var</span> percent = (loadedCount / count * <span class="number">100</span>) | <span class="number">0</span>;</span><br><span class="line">        percent = <span class="built_in">Math</span>.min(percent, <span class="number">100</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(percent);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">LoaderScene.preload = <span class="function"><span class="keyword">function</span>(<span class="params">resources, cb</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> _cc = cc;</span><br><span class="line">    <span class="keyword">if</span>(!_cc.loaderScene) &#123;</span><br><span class="line">        _cc.loaderScene = <span class="keyword">new</span> LoaderScene();</span><br><span class="line">        _cc.loaderScene.init();</span><br><span class="line">    &#125;</span><br><span class="line">    _cc.loaderScene.initWithResources(resources, cb);</span><br><span class="line">    cc.director.runScene(_cc.loaderScene);</span><br><span class="line">    <span class="keyword">return</span> _cc.loaderScene;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">LoaderScene.ajaxLoad = <span class="function"><span class="keyword">function</span>(<span class="params">ajaxSetting</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> _cc = cc;</span><br><span class="line">    <span class="keyword">if</span>(!_cc.loaderScene) &#123;</span><br><span class="line">        _cc.loaderScene = <span class="keyword">new</span> LoaderScene();</span><br><span class="line">        _cc.loaderScene.init();</span><br><span class="line">    &#125;</span><br><span class="line">    _cc.loaderScene.initAjax(ajaxSetting);</span><br><span class="line">    cc.director.runScene(_cc.loaderScene);</span><br><span class="line">    <span class="keyword">return</span> _cc.loaderScene;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p></p><p>如果是普通的资源加载调用<code>LoaderScene.preload</code>,如果是ajax加载定调用<code>LoaderScene.ajaxLoad</code>,配合上面的ajax封装来用：</p><p></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">LoaderScene.preload(g_resources, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">'loaded！！！'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">LoaderScene.ajaxLoad(&#123;</span><br><span class="line">	url: <span class="string">'test.json'</span>,</span><br><span class="line">	data: &#123;<span class="string">'name'</span>: <span class="string">'ddd'</span>&#125;</span><br><span class="line">	success: <span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">		<span class="built_in">console</span>.log(data);</span><br><span class="line">	&#125;,</span><br><span class="line">	error: <span class="function"><span class="keyword">function</span>(<span class="params">xhr, status, msg</span>)</span>&#123;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p></p><p>其中有个显示ajax加载百分比的方法，需要用到一个生成加载百分比的方法，同时要把ajax封装里面的<code>if(o.progress)</code>的注释打开：</p><p></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">Utils.noop = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;;</span><br><span class="line"></span><br><span class="line">Utils.clamp = <span class="function"><span class="keyword">function</span>(<span class="params">n, min, max</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (n &lt; min) <span class="keyword">return</span> min;</span><br><span class="line">    <span class="keyword">if</span> (n &gt; max) <span class="keyword">return</span> max;</span><br><span class="line">    <span class="keyword">return</span> n;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Utils.Progress = &#123;&#125;;</span><br><span class="line"><span class="comment">//设置最小值、更新频率和速度</span></span><br><span class="line">Utils.Progress.settings = &#123;</span><br><span class="line">    minimum: <span class="number">0.1</span>,</span><br><span class="line">    trickle: <span class="literal">true</span>,</span><br><span class="line">    trickleRate: <span class="number">0.3</span>,</span><br><span class="line">    trickleSpeed: <span class="number">100</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Utils.Progress.status = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">Utils.Progress.set = <span class="function"><span class="keyword">function</span>(<span class="params">n</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> progress = Utils.Progress;</span><br><span class="line">    n = Utils.clamp (n, progress.settings.minimum, <span class="number">1</span>);</span><br><span class="line">    progress.status = n;</span><br><span class="line">    progress.cb(progress.status);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Utils.Progress.inc = <span class="function"><span class="keyword">function</span>(<span class="params">amount</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> progress = Utils.Progress,</span><br><span class="line">        n = progress.status;</span><br><span class="line">    <span class="keyword">if</span> (!n) &#123;</span><br><span class="line">        <span class="keyword">return</span> progress.start();</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        amount = (<span class="number">1</span> - n) * Utils.clamp(<span class="built_in">Math</span>.random() * n, <span class="number">0.1</span>, <span class="number">0.95</span>);</span><br><span class="line">        n = Utils.clamp(n + amount, <span class="number">0</span>, <span class="number">0.994</span>);</span><br><span class="line">        <span class="keyword">return</span> progress.set(n);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Utils.Progress.trickle = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> progress = Utils.Progress;</span><br><span class="line">    <span class="keyword">return</span> progress.inc(<span class="built_in">Math</span>.random() * progress.settings.trickleRate);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Utils.Progress.start = <span class="function"><span class="keyword">function</span>(<span class="params">cb</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> progress = Utils.Progress;</span><br><span class="line">    progress.cb = cb || Utils.noop;</span><br><span class="line">    <span class="keyword">if</span> (!progress.status) progress.set(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> timer = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (progress.status === <span class="number">1</span>) &#123;</span><br><span class="line">            clearTimeout(timer);</span><br><span class="line">            timer = <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        progress.trickle();</span><br><span class="line">        work();</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> work = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      setTimeout(timer, progress.settings.trickleSpeed);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">if</span> (progress.settings.trickle) work();</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Utils.Progress.done = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> progress = Utils.Progress;</span><br><span class="line">    <span class="keyword">return</span> progress.inc(<span class="number">0.3</span> + <span class="number">0.5</span> * <span class="built_in">Math</span>.random()).set(<span class="number">1</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p></p><p><strong>LoaderLayer的定义</strong></p><p>LoaderLayer是在加载的时候在当前场景上面添加一个遮罩层，这里主要是ajax加载的，代码如下：</p><p></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">Config.winSize = cc.size(<span class="number">720</span>, <span class="number">1134</span>);</span><br><span class="line">Config.w =  Config.winSize.width;</span><br><span class="line">Config.h =  Config.winSize.height;</span><br><span class="line">Config.w_2 = Config.w / <span class="number">2</span>;</span><br><span class="line">Config.h_2 = Config.h / <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> LoaderLayer = cc.LayerColor.extend(&#123;</span><br><span class="line">	count: <span class="number">0</span>,</span><br><span class="line">    ctor:<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>._super(cc.color(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">160</span>));</span><br><span class="line">        <span class="keyword">var</span> draw = <span class="keyword">new</span> cc.DrawNode();</span><br><span class="line">        draw.x = Config.w_2 - <span class="number">50</span>;</span><br><span class="line">        draw.y = <span class="number">260</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;<span class="number">3</span>; i++)&#123;</span><br><span class="line">            draw.drawRect(cc.p(<span class="number">40</span>*i, <span class="number">0</span>), cc.p(<span class="number">40</span>*i+<span class="number">20</span>, <span class="number">20</span>), cc.color(<span class="number">181</span>, <span class="number">181</span>, <span class="number">181</span>), <span class="number">1</span>, cc.color(<span class="number">181</span>, <span class="number">181</span>, <span class="number">181</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> draw2 = <span class="keyword">this</span>.draw = <span class="keyword">new</span> cc.DrawNode();</span><br><span class="line">        draw2.x = Config.w_2 - <span class="number">50</span>;</span><br><span class="line">        draw2.y = <span class="number">260</span>;</span><br><span class="line">        draw2.drawRect(cc.p(<span class="number">0</span>, <span class="number">0</span>), cc.p(<span class="number">20</span>, <span class="number">20</span>), cc.color(<span class="number">239</span>, <span class="number">178</span>, <span class="number">82</span>), <span class="number">1</span>, cc.color(<span class="number">239</span>, <span class="number">178</span>, <span class="number">82</span>));</span><br><span class="line">        <span class="keyword">this</span>.addChild(draw);</span><br><span class="line">        <span class="keyword">this</span>.addChild(draw2);</span><br><span class="line">        <span class="keyword">this</span>.schedule(<span class="keyword">this</span>.updateLoad, <span class="number">0.2</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    updateLoad: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    	<span class="keyword">var</span> draw = <span class="keyword">this</span>.draw;</span><br><span class="line">    	draw.clear();</span><br><span class="line">    	<span class="keyword">if</span>(<span class="keyword">this</span>.count &gt;<span class="number">3</span>)&#123;</span><br><span class="line">    		<span class="keyword">this</span>.count = <span class="number">0</span>;</span><br><span class="line">    	&#125;</span><br><span class="line">    	<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>; i&lt; <span class="keyword">this</span>.count; i++)&#123;</span><br><span class="line">    		draw.drawRect(cc.p(<span class="number">40</span>*i, <span class="number">0</span>), cc.p(<span class="number">40</span>*i+<span class="number">20</span>, <span class="number">20</span>), cc.color(<span class="number">239</span>, <span class="number">178</span>, <span class="number">82</span>), <span class="number">1</span>, cc.color(<span class="number">239</span>, <span class="number">178</span>, <span class="number">82</span>));</span><br><span class="line">    	&#125;</span><br><span class="line">    	<span class="keyword">this</span>.count++;</span><br><span class="line">    &#125;,</span><br><span class="line">    onRemove: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="keyword">var</span> parent = <span class="keyword">this</span>.parent;</span><br><span class="line">        cc.eventManager.resumeTarget(parent,<span class="literal">true</span>);</span><br><span class="line">		parent.resume();</span><br><span class="line">		parent.removeChild(<span class="keyword">this</span>, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">LoaderLayer.preload = <span class="function"><span class="keyword">function</span>(<span class="params">url, data, cb, parent</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">var</span> loader = cc.LoaderLayer;</span><br><span class="line">    <span class="keyword">if</span>(!loader) &#123;</span><br><span class="line">        loader = <span class="keyword">new</span> LoaderLayer();</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//parent.pause();</span></span><br><span class="line">    cc.eventManager.pauseTarget(parent,<span class="literal">true</span>);</span><br><span class="line">    parent.addChild(loader, <span class="number">99</span>);</span><br><span class="line">   	Utils.ajax(&#123;</span><br><span class="line">   		url: url,</span><br><span class="line">   		type: <span class="string">"POST"</span>,</span><br><span class="line">   		data: data,</span><br><span class="line">   		success: <span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">   			loader.onRemove();</span><br><span class="line">   			cb(data);</span><br><span class="line">   		&#125;,</span><br><span class="line">   		error: <span class="function"><span class="keyword">function</span>(<span class="params">xhr, status, msg</span>)</span>&#123;</span><br><span class="line">   			loader.onRemove();</span><br><span class="line">   			alert(msg);</span><br><span class="line">   		&#125;</span><br><span class="line">   	&#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p></p><p>使用也很简单：</p><p></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这里默认使用了ajax的post方法,parent一般都是this。</span></span><br><span class="line">LoaderLayer.preload(url, data, cb, parent);</span><br></pre></td></tr></table></figure><p></p><p><strong>H5离线缓存</strong></p><p>HTML5离线存储Application Cache可以让用户在离线状态下浏览网站内容，缓存之后的内容不会再次从服务器获取，除非缓存文件改变了。如何使用呢？这需要打开你的html文件在里面：</p><p></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span> <span class="attr">manifest</span>=<span class="string">"manifest.appcache"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure><p></p><p>接着在html文件的同级目录下面新建<code>manifest.appcache</code>，并加入如下内容：</p><p></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// manifest.appcache</span><br><span class="line">CACHE MANIFEST</span><br><span class="line">#version 1.0</span><br><span class="line">CACHE:</span><br><span class="line">	css/main.css</span><br><span class="line">	img/test.png</span><br><span class="line"></span><br><span class="line">NETWORK:</span><br><span class="line">	*</span><br></pre></td></tr></table></figure><p></p><p>关于manifest.appcache文件，基本格式为三段： CACHE， NETWORK，与 FALLBACK，其中NETWORK和FALLBACK为可选项，而第一行CACHE MANIFEST为固定格式，必须写在前面。</p><p>CACHE是必须参数，标识出哪些文件需要缓存，可以是相对路径也可以是绝对路径</p><p>NETWORK是可选参数，这一部分是要绕过缓存直接读取的文件，可以使用通配符＊，也就是说除了上面的cache文件，剩下的文件每次都要重新拉取。</p><p>FALLBACK也是可选参数，指定了一个后备页面，当资源无法访问时，浏览器会使用该页面。该段落的每条记录都列出两个 URI—第一个表示资源，第二个表示后备页面。两个 URI 都必须使用相对路径并且与清单文件同源。可以使用通配符。</p><p>有了上面两个文件之后还要配置服务器的mime.types类型，找大盘apache的mime.types文件，添加</p><p></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">text/cache-manifest .appcache</span><br></pre></td></tr></table></figure><p></p><p>上面文件配置完成之后，application cache就可以运行了。</p><p>更新缓存的方式有三种：</p><ul><li>更新manifest文件</li></ul><p>可以修改一下manifest文件，把version改为1.1，然后刷新页面。</p><ul><li>通过javascript操作</li></ul><p>js添加一个监听事件：</p><p></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.applicationCache.addEventListener(<span class="string">'updateready'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'updateready!'</span>);</span><br><span class="line">    <span class="built_in">window</span>.applicationCache.swapCache();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p></p><ul><li>清除浏览器缓存</li></ul><p>站点离线存储的容量限制是5M；如果manifest文件，或者内部列举的某一个文件不能正常下载，整个更新过程将视为失败，浏览器继续全部使用老的缓存。</p></div><div class="post-copyright"><p class="copyright-item"><span>原文作者: </span><a href="https://www.noonme.com">bukas</a></p><p class="copyright-item"><span>原文链接: </span><a href="https://www.noonme.com/post/2014/12/使用cocos2d-js开发h5游戏/">https://www.noonme.com/post/2014/12/使用cocos2d-js开发h5游戏/</a></p><p class="copyright-item"><span>许可协议: </span><a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank">知识共享署名-非商业性使用 4.0 国际许可协议</a></p></div><div class="post-reward"><input type="checkbox" name="reward" id="reward" hidden> <label class="reward-button" for="reward">赞赏支持</label><div class="qr-code"><label class="qr-code-image" for="reward"><img class="image" src="/image/reward/wechat.png" title="wechat"></label> <label class="qr-code-image" for="reward"><img class="image" src="/image/reward/alipay.png" title="alipay"></label></div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/cocos2d-js/">cocos2d-js</a> <a href="/tags/html5/">html5</a></div><nav class="post-nav"><a class="prev" href="/post/2015/01/ajax跨域问题解决方案/"><i class="iconfont icon-left"></i> <span class="prev-text nav-default">ajax跨域问题解决方案</span> <span class="prev-text nav-mobile">上一篇</span> </a><a class="next" href="/post/2014/10/getting-started-with-gulp/"><span class="next-text nav-default">Gulp上手</span> <span class="prev-text nav-mobile">下一篇</span> <i class="iconfont icon-right"></i></a></nav></footer></article></div><div class="comments" id="comments"><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div></div></div></main><footer id="footer" class="footer"><div class="social-links"><a href="mailto:yhz1219@gmail.com" class="iconfont icon-email" title="email"></a> <a href="https://github.com/huanz" class="iconfont icon-github" title="github"></a> <a href="http://weibo.com/2335228667/" class="iconfont icon-weibo" title="weibo"></a> <a href="/rss.xml" class="iconfont icon-rss" title="rss"></a></div><div class="copyright"><span class="power-by">由 <a class="hexo-link" href="https://hexo.io/">Hexo</a> 强力驱动 </span><span class="division">|</span> <span class="theme-info">主题 - <a class="theme-link" href="https://github.com/ahonn/hexo-theme-even">Even</a> </span><span class="copyright-year">&copy;2015 - 2019<span class="heart"> <i class="iconfont icon-heart"></i> </span><span class="author">bukas</span> <span>京ICP备18012917号</span></span></div></footer><div class="back-to-top" id="back-to-top"><i class="iconfont icon-up"></i></div></div><script>var disqus_config=function(){this.page.url="https://www.noonme.com/post/2014/12/使用cocos2d-js开发h5游戏/",this.page.identifier="post/2014/12/使用cocos2d-js开发h5游戏/",this.page.title="使用cocos2d-js开发h5游戏"};!function(){var t=document,s=t.createElement("script");s.src="//bukas.disqus.com/embed.js",s.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(s)}()</script><script src="/lib/jquery/jquery.min.js"></script><script src="/lib/slideout/slideout.js"></script><script src="/lib/fancybox/jquery.fancybox.pack.js"></script><script src="/lib/pjax/jquery.pjax.min.js"></script><script src="/lib/nprogress/nprogress.min.js"></script><script src="/js/src/even.js?v=2.11.0"></script></body></html>