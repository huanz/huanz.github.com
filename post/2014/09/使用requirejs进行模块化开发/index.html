<!DOCTYPE html><html lang="zh-cn"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta name="renderer" content="webkit"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="referrer" content="always"><meta name="author" content="bukas"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="theme-color" content="#c05b4d"><meta name="msapplication-navbutton-color" content="#c05b4d"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#c05b4d"><meta name="format-detection" content="telphone=no, email=no"><meta name="msapplication-TileColor" content="#c05b4d"><meta name="screen-orientation" content="portrait"><meta name="x5-orientation" content="portrait"><meta name="apple-touch-fullscreen" content="yes"><meta name="full-screen" content="yes"><meta name="x5-fullscreen" content="true"><meta name="x5-page-mode" content="app"><meta name="browsermode" content="application"><meta name="msapplication-config" content="/browserconfig.xml"><link rel="manifest" href="/manifest.json"><meta name="msapplication-TileImage" content="/image/icon/144x144.png"><link rel="apple-touch-icon" sizes="60x60" href="/image/icon/60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/image/icon/72x72.png"><link rel="apple-touch-icon" sizes="120x120" href="/image/icon/120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/image/icon/144x144.png"><link rel="icon" type="image/png" sizes="192x192" href="/image/icon/192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/image/icon/32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/image/icon/96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/image/icon/16x16.png"><meta name="description" content="使用requirejs进行模块化开发"><meta name="keywords" content="javascript, 前端博客"><meta name="baidu-site-verification" content="SWwJlIQz43"><meta name="google-site-verification" content="9c8gt3muwQc_44xCxDE2Op-g1Wn9C2vzhYP-rXVLqlU"><link rel="amphtml" href="https://mercury.postlight.com/amp?url=https://www.noonme.com/post/2014/09/使用requirejs进行模块化开发/"><link rel="alternate" href="/rss.xml" title="前端博客"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2.11.0"><link rel="canonical" href="https://www.noonme.com/post/2014/09/使用requirejs进行模块化开发/"><link rel="stylesheet" href="/lib/fancybox/jquery.fancybox.css"><link rel="stylesheet" href="/lib/nprogress/nprogress.min.css"><link rel="stylesheet" href="/css/style.css?v=2.11.0"><script id="baidu_analytics">var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?b55278bdcb7115441071d19eb18b0d97";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-49034721-1"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-49034721-1")</script><script id="baidu_push">!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script src="//cdn1.lncld.net/static/js/3.1.1/av-min.js"></script><script id="leancloud">AV.init({appId:"xoEVsPhgw6N3YPfMBXnq6q1K-gzGzoHsz",appKey:"WMWiVHdG2AKdDrC6kgUCoBnU"})</script><script>window.config={leancloud:{app_id:"xoEVsPhgw6N3YPfMBXnq6q1K-gzGzoHsz",app_key:"WMWiVHdG2AKdDrC6kgUCoBnU"},toc:!0,fancybox:!0,pjax:!0,latex:!1}</script><title>使用requirejs进行模块化开发 - 前端博客</title></head><body><div id="mobile-navbar" class="mobile-navbar"><div class="mobile-header-logo"><a href="/." class="logo">前端博客</a></div><div class="mobile-navbar-icon"><span></span> <span></span> <span></span></div></div><nav id="mobile-menu" class="mobile-menu slideout-menu"><ul class="mobile-menu-list"><a href="/"><li class="mobile-menu-item">首页</li></a><a href="/archives/"><li class="mobile-menu-item">归档</li></a><a href="/about"><li class="mobile-menu-item">关于</li></a></ul></nav><div class="container" id="mobile-panel"><header id="header" class="header"><div class="logo-wrapper"><a href="/." class="logo">前端博客</a></div><nav class="site-navbar"><ul id="menu" class="menu"><li class="menu-item"><a class="menu-item-link" href="/">首页</a></li><li class="menu-item"><a class="menu-item-link" href="/archives/">归档</a></li><li class="menu-item"><a class="menu-item-link" href="/about">关于</a></li></ul></nav></header><main id="main" class="main"><div class="content-wrapper"><div id="content" class="content"><article class="post"><header class="post-header"><h1 class="post-title">使用requirejs进行模块化开发</h1><div class="post-meta"><span class="post-time">2014-09-26 </span><span class="post-category"><a href="/categories/technology/">technology</a> </span><span class="post-visits" data-url="/post/2014/09/使用requirejs进行模块化开发/" data-title="使用requirejs进行模块化开发">阅读次数 0</span></div></header><div class="post-content"><p>在之前的项目中一直用的是seajs，感觉seajs是挺好用的，但是有个问题就是把现有的js框架打包成seajs模块略麻烦，官方文档里面也没有对这一块作详细的介绍，虽然有spm build，但还是觉得不太方便。因此便在新的项目中用了requirejs。</p><a id="more"></a><p><img src="http://blog.u.qiniudn.com/uploads%2Frequirejs.png" alt="requirejs"></p><p>用requirejs其实还有另一个原因就是项目中用到了百度的图表库<a href="http://echarts.baidu.com/" title="echarts" target="_blank" rel="noopener">echarts</a>，根据其官方文档的描述是不建议使用基于CMD规范的seajs来加载的，因为echarts是基于AMD模块化的，虽然网上有人改了可以用seajs加载，但是我最后还是选择用requirejs来加载，同时也是想尝试一下requirejs。</p><p><strong>自定义构建echarts</strong></p><p><code>echarts</code>的构建是用的<code>r.js</code>，因此我在这里先讲一下。</p><p>自定义构建<code>echarts</code>还必须下载<code>zrender</code>，下载完成之后，把<code>echarts</code>的目录和<code>zrender</code>目录放在同级目录下，然后进入<code>echarts</code>的<code>build</code>目录进行自定义<code>build</code>（需要node.js环境），下面是我的build命令：</p><p></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node build.js optimize=<span class="literal">true</span> exclude=force,scatter,k,radar,chord,gauge,funnel,map  output=echarts1.js</span><br></pre></td></tr></table></figure><p></p><p>上面命令的意思是排除<code>exclude</code>的之后的那些模块，因为我只用到了<code>echarts</code>的折线图、柱状图和饼状图。</p><p>执行完成之后就可以在build目录看到刚才合并的<code>echarts1.js</code></p><p><strong>requirejs模块加载配置</strong></p><p><code>requirejs</code>引入主模块的方法是通过在script标签里面添加<code>data-main</code>属性，如我的引入代码：</p><p></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">data-main</span>=<span class="string">"js/main"</span> <span class="attr">src</span>=<span class="string">"js/lib/requirejs/require.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><p><code>main.js</code>是程序的入口js文件，然后我们在<code>main.js</code>里面进行模块的加载配置：</p><p></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">requirejs.config(&#123;</span><br><span class="line">	<span class="comment">//开发专用，阻止浏览器缓存</span></span><br><span class="line">	urlArgs: <span class="string">"v="</span> + <span class="built_in">Date</span>.now(),</span><br><span class="line">	<span class="comment">//js文件的目录，相对于引入main.js的那个文件的目录</span></span><br><span class="line">	baseUrl: <span class="string">'js'</span>,</span><br><span class="line">	<span class="comment">//对于默认不兼容AMD规范的模块通过shim来配置</span></span><br><span class="line">	<span class="comment">//deps数组，表明该模块的依赖性，</span></span><br><span class="line">	<span class="comment">//exports值，表明这个模块外部调用时的名称</span></span><br><span class="line">	<span class="comment">//下面代码里面包含了如何加载库和插件</span></span><br><span class="line">	shim: &#123;</span><br><span class="line">    	<span class="string">'backbone'</span>: &#123;</span><br><span class="line">       	 	deps: [<span class="string">'underscore'</span>, <span class="string">'jquery'</span>],</span><br><span class="line">        	exports: <span class="string">'Backbone'</span></span><br><span class="line">    	&#125;,</span><br><span class="line">    	<span class="string">'underscore'</span>: &#123;</span><br><span class="line">        	exports: <span class="string">'_'</span></span><br><span class="line">    	&#125;,</span><br><span class="line">    	<span class="string">'backbone.localStorage'</span>: &#123;</span><br><span class="line">  			deps: [<span class="string">'backbone'</span>],</span><br><span class="line">  			exports: <span class="string">'Backbone'</span></span><br><span class="line">		&#125;,</span><br><span class="line">		<span class="string">'bootstrap.modal'</span>: &#123;</span><br><span class="line">        	deps: [<span class="string">'jquery'</span>],</span><br><span class="line">        	exports: <span class="string">'jQuery.fn.modal'</span></span><br><span class="line">    	&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="comment">//模块的加载路径（不要加.js后缀，因为默认就是加载js，加了会报错）</span></span><br><span class="line">	<span class="comment">//路径是相对于上面的baseUrl</span></span><br><span class="line">	paths: &#123;</span><br><span class="line">		jquery: <span class="string">'lib/jquery/jquery-1.11.1.min'</span>,</span><br><span class="line">		underscore: <span class="string">'lib/underscore/underscore-min'</span>,</span><br><span class="line">		...</span><br><span class="line">		text: <span class="string">'lib/requirejs/plugins/text'</span>,</span><br><span class="line">		echarts:<span class="string">'lib/echarts/echarts'</span>,</span><br><span class="line">    	<span class="string">'echarts/chart/bar'</span> : <span class="string">'lib/echarts/echarts'</span>,</span><br><span class="line">		config: <span class="string">'modules/common/config'</span></span><br><span class="line">	&#125;	</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//下面开始加载执行</span></span><br><span class="line"><span class="built_in">require</span>([<span class="string">'backbone'</span>, <span class="string">'modules/app'</span>], <span class="function"><span class="keyword">function</span> (<span class="params">Backbone, AppRouter</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">new</span> AppRouter();</span><br><span class="line">	Backbone.history.start();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p></p><p><strong>requirejs模块定义与加载</strong></p><p><code>requirejs</code>定义一个模块相当简单，下面是一个简单的例子:</p><p></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">define([<span class="string">'backbone'</span>], <span class="function"><span class="keyword">function</span>(<span class="params">Backbone</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">var</span> AppRouter = Backbone.Router.extend(&#123;</span><br><span class="line">		...</span><br><span class="line">	&#125;);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//导出对象</span></span><br><span class="line">	<span class="keyword">return</span> AppRouter;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p></p><p>我们也可以动态加载模块：</p><p></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">define([<span class="string">'backbone'</span>], <span class="function"><span class="keyword">function</span>(<span class="params">Backbone</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">var</span> AppRouter = Backbone.Router.extend(&#123;</span><br><span class="line">		...</span><br><span class="line">		index： <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">			<span class="built_in">require</span>([<span class="string">'echarts'</span>, <span class="string">'echarts/chart/bar'</span>], <span class="function"><span class="keyword">function</span>(<span class="params">ec</span>)</span>&#123;</span><br><span class="line">				...</span><br><span class="line">			&#125;);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//导出对象</span></span><br><span class="line">	<span class="keyword">return</span> AppRouter;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p></p><p>如果你已经用习惯了<code>seajs</code>的模块加载方法的话，你也可以像<code>seajs</code>里面那样去加载模块：</p><p></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">define(<span class="function"><span class="keyword">function</span> (<span class="params">require</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> $ = <span class="built_in">require</span>(<span class="string">'jquery'</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">	    ...</span><br><span class="line">	&#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p></p><p>或者<code>CommonJS</code>的方式也ok:</p><p></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">define(<span class="function"><span class="keyword">function</span>(<span class="params">require, exports, module</span>) </span>&#123;</span><br><span class="line">	...</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p></p><p><code>requirejs</code>提供一个加载文本的插件<code>text.js</code>，细心的话你可能已经看到我在<code>requirejs.config</code>里面已经配置了，使用也很简单：</p><p></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注意这里自定义模块的加载路径</span></span><br><span class="line"><span class="comment">// 可以写相对路径，那就是相对于当前js文件的路径</span></span><br><span class="line"><span class="comment">// 也可以写绝对路径，就是相对于baseUrl的路径</span></span><br><span class="line">define([<span class="string">'backbone'</span>,<span class="string">'text!../tmpl/index.html'</span>], <span class="function"><span class="keyword">function</span>(<span class="params">Backbone, html</span>)</span>&#123;</span><br><span class="line">	</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p></p><p><strong>requirejs构建工具r.js</strong></p><p>当项目上线的时候，我们可能需要对模块代码进行压缩合并的操作，这时我们就会用到<code>requirejs</code>的构建工具<code>r.js</code>。首先我们在项目根目录创建一个<code>build</code>的文件夹和<code>dist</code>的文件夹，分别用来存放模块合并相关配置和合并后的代码的文件目录，在<code>build</code>目录里面存放<code>r.js</code>，并新建一个压缩合并的配置文件<code>config.js</code>,下面是<code>config.js</code>的配置示例：</p><p></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//config.js</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//requirejs.cofig文件的路径,它会自动读取main.js里面的配置信息</span></span><br><span class="line">	mainConfigFile : <span class="string">"../js/main.js"</span>,</span><br><span class="line">	baseUrl: <span class="string">'../js'</span>,</span><br><span class="line">	name: <span class="string">"main"</span>,</span><br><span class="line">	<span class="comment">//输出文件的路径和名称</span></span><br><span class="line">	out: <span class="string">"../dist/js/main.js"</span>,</span><br><span class="line">	<span class="comment">//默认情况写r.js会把相关的依赖文件拷贝到输出目录里面去</span></span><br><span class="line">	<span class="comment">//设置为true之后r.js就不会进行这一操作</span></span><br><span class="line">	removeCombined: <span class="literal">true</span>,</span><br><span class="line">	<span class="comment">//findNestedDependencies设置为true表示将所有相关的依赖模块也合并进来，默认为false只会对main.js进行压缩合并的操作</span></span><br><span class="line">	findNestedDependencies: <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>然后在命令行执行：</p><p></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node r.js -o config.js</span><br></pre></td></tr></table></figure><p></p><p>执行完成之后便会在<code>dist/js/</code>目录下面生成一个合并后的<code>main.js</code></p><p>你会发现这个<code>main.js</code>可能会非常大，而在实际项目中，像通用的一些jquery、backbone等有时候我们可能没有必要把它压缩进来，我们只需要压缩自己写的一些代码，于是我们再次开始配置我们的<code>config.js</code>：</p><p></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	mainConfigFile : <span class="string">"../js/main.js"</span>,</span><br><span class="line">	baseUrl: <span class="string">"../js"</span>,</span><br><span class="line">	removeCombined: <span class="literal">true</span>,</span><br><span class="line">	findNestedDependencies: <span class="literal">true</span>,</span><br><span class="line">	dir: <span class="string">"../dist/js"</span>,</span><br><span class="line">	modules: [&#123;</span><br><span class="line">		name: <span class="string">"main"</span>,</span><br><span class="line">        exclude: [</span><br><span class="line">            <span class="string">"backbone"</span>,</span><br><span class="line">			<span class="string">"underscore"</span>,</span><br><span class="line">            <span class="string">"jquery"</span>,</span><br><span class="line">            <span class="string">"text"</span>,</span><br><span class="line">			...</span><br><span class="line">        ]</span><br><span class="line">    &#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>再次运行压缩合并命令将会发现在<code>exclude</code>数组里面的项不会被合并。</p><p>然而我觉得更好的做法是把通用的一些库，如jquery,bacnbone等合并到一个文件里面，我们自己的代码合并到了一个文件，因此，我们重新进行配置。</p><p>首先我们新建一个js文件，这个js文件啥也不用做，就是为了引用所有通用的库，这样方便我们进行排除，如下：</p><p></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//libs.js</span></span><br><span class="line">	</span><br><span class="line">define([</span><br><span class="line">	<span class="string">"jquery"</span>,</span><br><span class="line">	<span class="string">"underscore"</span>,</span><br><span class="line">	<span class="string">"backbone"</span>,</span><br><span class="line">	...</span><br><span class="line">	<span class="string">"text"</span></span><br><span class="line">], <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;);</span><br></pre></td></tr></table></figure><p></p><p>然后我们的<code>config.js</code>变成了这样：</p><p></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	mainConfigFile : <span class="string">"../js/main.js"</span>,</span><br><span class="line">	baseUrl: <span class="string">"../js"</span>,</span><br><span class="line">	removeCombined: <span class="literal">true</span>,</span><br><span class="line">	findNestedDependencies: <span class="literal">true</span>,</span><br><span class="line">	dir: <span class="string">"../dist/js"</span>,</span><br><span class="line">	modules: [</span><br><span class="line">    	&#123;</span><br><span class="line">       	 name: <span class="string">"main"</span>,</span><br><span class="line">        	exclude: [</span><br><span class="line">            	<span class="string">"libs"</span></span><br><span class="line">        	]</span><br><span class="line">    	&#125;,</span><br><span class="line">   		&#123;</span><br><span class="line">       		name: <span class="string">"libs"</span></span><br><span class="line">   	 	&#125;</span><br><span class="line">	]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>现在，我们的<code>build</code>操作终于完美了。</p><p>但是，如果我们的js直接通过cdn引用的呢？如果我们直接运行上面的压缩配置，<code>r.js</code>将会报错。因此，对于从cdn引入的js，我们作如下配置：</p><p></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">requirejs.config(&#123;</span><br><span class="line">	paths: &#123;</span><br><span class="line">		<span class="comment">//如果cdn挂点，通过本地加载jquery</span></span><br><span class="line">    	jquery: [<span class="string">'http://cdn.staticfile.org/jquery/1.11.1/jquery.min.js'</span>, <span class="string">'lib/jquery/jquery-1.11.1.min'</span>],</span><br><span class="line">    	underscore: <span class="string">'lib/underscore/underscore-min'</span>,</span><br><span class="line">    	...</span><br><span class="line">    	text: <span class="string">'lib/requirejs/plugins/text'</span>,</span><br><span class="line">    	echarts:<span class="string">'lib/echarts/echarts'</span>,</span><br><span class="line">    	<span class="string">'echarts/chart/bar'</span> : <span class="string">'lib/echarts/echarts'</span>,</span><br><span class="line">    	config: <span class="string">'modules/common/config'</span></span><br><span class="line">	&#125;  </span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//修改config.js</span></span><br><span class="line">&#123;</span><br><span class="line">	mainConfigFile : <span class="string">"../js/main.js"</span>,</span><br><span class="line">	baseUrl: <span class="string">"../js"</span>,</span><br><span class="line">	removeCombined: <span class="literal">true</span>,</span><br><span class="line">	findNestedDependencies: <span class="literal">true</span>,</span><br><span class="line">	dir: <span class="string">"../dist/js"</span>,</span><br><span class="line">	modules: [</span><br><span class="line">    	&#123;</span><br><span class="line">       	 name: <span class="string">"main"</span>,</span><br><span class="line">        	exclude: [</span><br><span class="line">            	<span class="string">"libs"</span></span><br><span class="line">        	]</span><br><span class="line">    	&#125;,</span><br><span class="line">   		&#123;</span><br><span class="line">       		name: <span class="string">"libs"</span></span><br><span class="line">   	 	&#125;</span><br><span class="line">	],</span><br><span class="line">	paths: &#123;</span><br><span class="line">    	jquery: <span class="string">"empty:"</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>我们再次运行合并的操作<code>node r.js -o config.js</code>会发现此时<code>r.js</code>没有把<code>jquery</code>合并进来，因为它是通过cdn加载的。</p><p><strong>css的压缩合并配置</strong></p><p>虽然我的项目中没有用到，但在这里还是说一下吧。</p><p>项目中可能引用了多个css文件，如：</p><p></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">href</span>=<span class="string">"css/bootstrap.css"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">href</span>=<span class="string">"css/style.css"</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><p>如果我们只想引用一个css文件，我们可以这样：</p><p></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">import</span> url(<span class="string">'/css/bootstrap.css'</span>);</span><br><span class="line"><span class="comment">/* style.css content here…. */</span></span><br></pre></td></tr></table></figure><p></p><p>然后在压缩合并的时候进行配置：</p><p></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//config.js</span></span><br><span class="line">&#123;</span><br><span class="line">	mainConfigFile : <span class="string">"../js/main.js"</span>,</span><br><span class="line">	appDir: <span class="string">"../"</span>,</span><br><span class="line">	baseUrl: <span class="string">"js"</span>,</span><br><span class="line">	removeCombined: <span class="literal">true</span>,</span><br><span class="line">	findNestedDependencies: <span class="literal">true</span>,</span><br><span class="line">	dir: <span class="string">"../dist"</span>,</span><br><span class="line">	optimizeCss: <span class="string">"standard"</span>,</span><br><span class="line">	modules: [</span><br><span class="line">    	&#123;</span><br><span class="line">       	 name: <span class="string">"main"</span>,</span><br><span class="line">        	exclude: [</span><br><span class="line">            	<span class="string">"libs"</span></span><br><span class="line">        	]</span><br><span class="line">    	&#125;,</span><br><span class="line">   		&#123;</span><br><span class="line">       		name: <span class="string">"libs"</span></span><br><span class="line">   	 	&#125;</span><br><span class="line">	],</span><br><span class="line">	paths: &#123;</span><br><span class="line">    	jquery: <span class="string">"empty:"</span></span><br><span class="line">	&#125;，</span><br><span class="line">	<span class="comment">//匹配到的文件或者目录不会被拷贝到dist目录</span></span><br><span class="line">	fileExclusionRegExp: <span class="regexp">/(^\.|build|dist|sass|config.rb)/</span>,</span><br><span class="line">	generateSourceMaps: <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><blockquote><p><code>appDir</code>：项目根目录</p><p><code>optimizeCss</code> ：css压缩规则，有四种，分别是：<code>none</code> 、<code>standard</code> 、<code>standard.keeplines</code>、<code>standard.keepComments</code>、<code>standard.keepComments.keeplines</code>。具体意思我就不一一解释了。</p><p><code>generateSourceMaps</code>：生成map文件，把压缩过的js与未压缩的作映射</p></blockquote></div><div class="post-copyright"><p class="copyright-item"><span>原文作者: </span><a href="https://www.noonme.com">bukas</a></p><p class="copyright-item"><span>原文链接: </span><a href="https://www.noonme.com/post/2014/09/使用requirejs进行模块化开发/">https://www.noonme.com/post/2014/09/使用requirejs进行模块化开发/</a></p><p class="copyright-item"><span>许可协议: </span><a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank">知识共享署名-非商业性使用 4.0 国际许可协议</a></p></div><div class="post-reward"><input type="checkbox" name="reward" id="reward" hidden> <label class="reward-button" for="reward">赞赏支持</label><div class="qr-code"><label class="qr-code-image" for="reward"><img class="image" src="/image/reward/wechat.png" title="wechat"></label> <label class="qr-code-image" for="reward"><img class="image" src="/image/reward/alipay.png" title="alipay"></label></div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/javascript/">javascript</a></div><nav class="post-nav"><a class="prev" href="/post/2014/10/github-digitalocean/"><i class="iconfont icon-left"></i> <span class="prev-text nav-default">Github免费送DigitalOcean 100刀和免费me域名一年</span> <span class="prev-text nav-mobile">上一篇</span> </a><a class="next" href="/post/2014/09/靠谱的DNS推荐/"><span class="next-text nav-default">靠谱的DNS推荐</span> <span class="prev-text nav-mobile">下一篇</span> <i class="iconfont icon-right"></i></a></nav></footer></article></div><div class="comments" id="comments"><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div></div></div></main><footer id="footer" class="footer"><div class="social-links"><a href="mailto:yhz1219@gmail.com" class="iconfont icon-email" title="email"></a> <a href="https://github.com/huanz" class="iconfont icon-github" title="github"></a> <a href="http://weibo.com/2335228667/" class="iconfont icon-weibo" title="weibo"></a> <a href="/rss.xml" class="iconfont icon-rss" title="rss"></a></div><div class="copyright"><span class="power-by">由 <a class="hexo-link" href="https://hexo.io/">Hexo</a> 强力驱动 </span><span class="division">|</span> <span class="theme-info">主题 - <a class="theme-link" href="https://github.com/ahonn/hexo-theme-even">Even</a> </span><span class="copyright-year">&copy;2015 - 2019<span class="heart"> <i class="iconfont icon-heart"></i> </span><span class="author">bukas</span> <span>京ICP备18012917号</span></span></div></footer><div class="back-to-top" id="back-to-top"><i class="iconfont icon-up"></i></div></div><script>var disqus_config=function(){this.page.url="https://www.noonme.com/post/2014/09/使用requirejs进行模块化开发/",this.page.identifier="post/2014/09/使用requirejs进行模块化开发/",this.page.title="使用requirejs进行模块化开发"};!function(){var e=document,t=e.createElement("script");t.src="//bukas.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)}()</script><script src="/lib/jquery/jquery.min.js"></script><script src="/lib/slideout/slideout.js"></script><script src="/lib/fancybox/jquery.fancybox.pack.js"></script><script src="/lib/pjax/jquery.pjax.min.js"></script><script src="/lib/nprogress/nprogress.min.js"></script><script src="/js/src/even.js?v=2.11.0"></script></body></html>